


버텍스, 픽셀 버퍼 생성->셰이더생성->상수버퍼생성->인풋레이아웃 생성(버텍스셰이더.cso사용)

좌표설정

인풋레이아웃 세팅->프리미티브토폴로지 세팅->렌더스테이트 세팅->버텍스, 인덱스버퍼 세팅
->상수버퍼업데이트->버텍스, 픽셀, 상수버퍼 세팅->그리기

디바이스만들고 스왑체인 만들고 
온리사이즈에서 렌더타겟 뷰 만들고
뎁스스텐신버퍼와 뷰 만들어서 세팅하고 뷰포트변환하고 뷰포트 세팅하고

옵젝마다 가지고 있을게 크기, 좌표, 색이라던가...


추가하면 렌더러가 그리는거야
큐브의 정보를 추가하고



그리드는 7*7 높이는 16
바닥 7*7
벽 7*16


newBehaviourScript->MonoBehaviour->Behaviour->Component->Object
						       			Component->GameObject->Object
Object 
name
hideflags X
instanceid

destroy
find


GameObject
transform
layer
active
tag
scene
find
sendmessage
creategameobject



addcomponent
getcomponent
Component
camera
renderer
collider


바꾸자
최종은?
게임오브젝트위에 스크립트가 있고 그러면
아니다 게임오브젝트를 최종으로 하고 그러면
gameobject->object
		->component
		->script

스크립트가 업뎃등을 만들어서 겜옵젝에 넘겨줘서 업뎃을 시키고
겜옵젝은 모든 컴포넌트를 널로 가지고 있으면서
애드하면 뉴로 생성하게 하자?
오브젝트는 인터페이스처럼 쓰자

이렇게 나누기만 하면 뭐가 남죠 흠

원래는
newBehaviourScript->MonoBehaviour->Behaviour->Component->Object
						       			Component->GameObject->Object

그럼 이렇게 하자
component가 gameobject*를 가지고 있고 
transform* 따로 가지고 있어 잘 생각해봐
그리고 온갖 컴포넌트들을 nullptr로 가지고 있어


script->component : object->gameobject : object
					->transform : component

얼탱이 없네
트랜스폼은 컴포넌트인데 왜 이렇게 있는데
브로드캐스트가 컴포넌트 사용하라고 메세지 보내는거래

그럼 게임 오브젝트는 컴포넌트를 겟만 하고


나에게 주어진건 
newBehaviourScript
MonoBehaviour
Behaviour
Component
Object						       			
GameObject

방송은 컴포넌트 안에 있으니까

역할을 먼저 정하자
Object는 이름과 id가 있고 지우기 찾기가 있으니까 모든 오브젝트의 베이스로 사용하자
GameObject는 트랜스폼과 이름 레이어 태그만 있음 완전 틀만 있어
Component는 일단 각 옵젝마다 할당되있는 모든 컴포넌트들에게 메세지를 보낼 수 있어야돼




fixedupdate에서 메세지를 보내고 모든 사용중인 컴포넌트가 받고
메세지에 따라서 시작
update에서 작동


add get 있고

스크립트도 컴포넌트처럼 붙으니까
모노비헤비어 상속 받는 스크립트는 모두 컴포넌트처럼 사용가능
스크립트에서 겟컴포넌트해서 수정하면



아 게임부터 완성 시켜야겠네




0 바닥
1 1층
2 2층





0 0 0 0 0 0 0
0 0 0 0 0 0 0
0 0 0 0 0 0 0
0 0 0 0 0 0 0
0 0 0 0 0 0 0
0 0 0 0 0 0 0
0 0 0 0 0 0 0



2 2
2 2


2 2 0 0 0 0 0
2 2 0 0 0 0 0
0 0 0 0 0 0 0
0 0 0 0 0 0 0
0 0 0 0 0 0 0
0 0 0 0 0 0 0
0 0 0 0 0 0 0


1 1 1
1

3
1

2 5 0 0 0 0 0
2 3 0 0 0 0 0 <- 높이는 5인데 지금대로면 3이 됨 (빈칸 높이 3, 4를 셀 수 있어야되는데 빈칸으로 취급해야됨)
0 0 0 0 0 0 0
0 0 0 0 0 0 0
0 0 0 0 0 0 0
0 0 0 0 0 0 0
0 0 0 0 0 0 0

한칸을 배열로 하면 그럼 배열을 49개 만들어야돼
이게 가장 편하긴 해
1100000
1111100
1100000
1100100

0,0의 3 0,1의 3 0,2의 3.... 전부 1일때 아니 삭제 아니 벡터니까 스택처럼 위에서 내려오는거까지 확실하게

그럼 블럭 배열은 어떻게 해볼까



1 1 9
1 8 9 -> R_2x2
9 9 9

1 1 9
9 8 1 -> S_3x2
9 9 9

9 9 9
1 8 1 -> L_3x2
1 9 9

9 9 9
1 8 1 -> T_3x2
9 1 9

9 9 9
9 8 9 -> O_1x1
9 9 9

9 9 9
1 8 1 -> I_3x1
9 9 9

9 9 9
1 8 9 -> I_2x1
9 9 9

9 9 9
9 8 1 -> V_2x2
9 1 9

방향키로 배열 [0][0]에 +, -

0이 바닥이니까 0은 빈공간으로 못 써 그럼 빈공간을 임의로 9로 하자 그럼 8이 회전축


7*7*7 로 만들어봐

테스트 씬 만들고 있었어
컴포들 작동하는지 확인하려고

옵젝 담아둘 매니저 있어야하고,
씬을 수정할 곳 있어야하고,

업데이트를 할 곳은 어디냐

머리 존나 아파

컴포는 기능만 제공하니까 업뎃할 필요없을걸
라기보단 업뎃할만한 컴포들이 아니야

그럼 스크립트들만 업뎃을 해야하는데 그럼


옵젝매니저 냅두고 옵젝 살짝 건들고
컴포넌트 건들고

다 고쳤으니까 이제 

블럭은 0.5 스타트로 +1, -1씩
x, z +2.5, -3.5까지
y는 최소 0.5, 최대 6.5까지 높이 7기준


가장 기본적인 것부터
바닥에 내려오면 멈추는거 *
멈추면 다음꺼를 생성하는거 
조작권을 다음꺼에 넘겨주는거

스크립트 업데이트를 어떻게 받아서 하지
결국 컴포넌트 전체를 업데이트해주는거 같은데 뭔가 아닌거 같아
생각할 시간 없으려나

인풋 고쳐

블럭을 만들어놓고
계속 복사하면 되려나
복사란 무엇인가

새로 만들거면 뉴해야하고


정리하자
사용중인 블럭이 없으면
블럭을 만들어? 불러와? (유니티에서는 프리팹을 어떻게 했던가) createobject를 하는 함수를 여러개 만들어서
예시 : createLBlock, createJBlock 이런식으로 여러개 만들어서 case별로 불러오게 하는게 좋을지도
그럼 씬에서 옵젝을 만들어서 씬에서 옵젝 업데이트를 돌리는거를 스크립트에서 옵젝을 만들어서 씬에서 업데이트 돌리는거를 어떻게 할지 생각해보자
아니지 잠깐만 옵젝 업뎃에서 컴포넌트 업뎃이 돌아가고 그러면 스크립트를 씬처럼 만든 옵젝을 업뎃을 돌리면
돌아가겠네 씬에서는 옵젝 하나 만들고 거기에 스크립트를 추가해서 업데이트 돌리면 되는거고
이렇게 하자
아 그러면 옵젝매니저를 새로 만들어야겠네? 받아오자 
에딧씬에서 메인옵젝 만들면서 옵젝매니저를 받아오고 거기서 생성하자

한 옵젝에 박스 여러개 vs 여러 옵젝


이제 바닥에 붙는거 만들자
공중에 뜬것도 disabled 상태가 되야해
완료

이제 멈추면 층에 따라 색이 바뀌고 멈춘거 높이 기준으로 블럭이 쌓여야해
층에 따라 색이 바뀌는걸 만들면 높이 기준으로 블럭 쌓는건 바로 될듯


회전했을때 삐져나가면 자동으로 안쪽으로 돌아오게 트랜슬레이트 해
오류 있으니까 고쳐 회전하면서 생기는 문제니까 회전에다가 추가해
좌우 z이동

회전 그만 건들자 거지같다

이제 멈추면 층에 따라 색이 바뀌고 멈춘거 높이 기준으로 블럭이 쌓여야해
층에 따라 색이 바뀌는걸 만들면 높이 기준으로 블럭 쌓는건 바로 될듯 <- 이거 하자 완료

왼쪽 위=[6][0]
-3, 3

오른쪽 아래=[0][6]
3,-3

떨어지기 직전에 돌리면 이상해짐 고쳐야됨


순서를 잘 생각해봐 블럭 색이 통일되고 잇잖아

일단 지금 있는 문제가 위치값이 살짝 달라서 배열에 이상하게 들어가고 <- 강제로 해결

1줄 맞춰지면 사라지게
쌓인 블럭을 줄에 따라 저장할 필요가 있고
그게 꽉차면 그 줄에 블럭을 전부 클리어하고, 윗 블럭을 밑으로 내리면서 새로 채우기

중간에 블럭있는곳에 블럭 밀어 넣으면 들어가짐 수정해야함

원래 맵으로 블럭 비교해서 같은 층 블럭 49개 되면 그 층 삭제하게 하려했음

블럭 밖으로 안 나가게 어디에 조건 만드냐 -> 완성



중간에 블럭있는곳에 블럭 밀어 넣으면 들어가짐 수정해야함
원래 맵으로 블럭 비교해서 같은 층 블럭 49개 되면 그 층 삭제하게 하려했음 -> 이거 먼저 하자
바닥에 닿기 직전에 돌리면 기울어진채로 박힘 ->회전중에 안 떨어지게 할까? 그러면 무한 회전할텐데

잘 생각해봐 바닥에서 회전시키면서 버티지만 결국 무너져 그건 3d테트리스가 아니라서 회전이 두 방향밖에 없고
뚝딱하고 회전하니까 그래도 되지만 3d는 회전하는게 보여야 해 그러니까 바닥에 닿으면 멈추게 하면서도
회전으로 중간에 멈추거나 바닥에 안 박히게 해야해

스탑 타임 위치를 잘 생각해봐

층마다 49개의 오브젝트가 생기면 삭제하고 그 층의 위층에 있던 오브젝트의 높이를 1씩 낮춘다
	

삭제좀 잘 하라고
막 꼬라박지말고 차근차근 천천히 고쳐나가


블럭을 벽으로 인식 안 함
스페이스바 높이 방어 안해놓음 -> 부모 아닌 블럭들과 1개짜리 블럭들만 안됨(1개짜리 블럭은 바닥도 뚫음)
지금이라도 레이랑 콜라이더를 추가할까 그거 만들면 3000배는 더 쉬워지는데

박스콜라이더를 일단 만들고
레이도 해보자

뭔가 잘못됐어
다시 고쳐

부모자식이 아니면서
충돌한 개체의 높이와 같으면서
충돌한 개체가 옆에 있으면

충돌 나가기 고치기

충돌한 개체가 나가려고 할때
그 말은 원래 충돌 중이던게 false가 됐을때


주체가 이미 설치된 블럭이 되면 안돼

벽감지 때문에 판정이 겹쳐
벽에도 충돌감지를 해야겠어
벽이 7*16 이었고 0.5*7*16으로 박스를 만들면 되지않을까 
센터위치는 0, +-3.5 +-3.5,0 하면 되지 않을까


충돌을 같은 상태의 것들끼리만 하니까
대각선을 인식을 못하는거 같아
충돌 매니저를 고쳐

자신과 충돌한 물체가 있어

자신과 자신을 비교하지말아
부모, 자식끼리도 비교하지 말아
물체가 충돌했으면 각자 상태에 따라 반응을 정해
테트로미노에서 충돌한 물체의 컨트롤권을 조작하자
현재는 자신의 컨트롤권을 조작했었으니까

익시트가 안 걸림 충돌 고쳐

물1, 물2, 물3

물1, 물2 충돌
물1, 물2 엔터
물1, 물2 스테이

물3, 물1 충돌
물3 물1 엔터, 물1 물2 스테이
물3 물1 스테이, 물1 물2 스테이

콜리전 데이터를 담은 벡터를 만들자
각 콜리전마다 다르게 작동해야하는데
맵으로?

뭘 빼먹었지
충돌은 다 됐는데 지금 ㅗ가 인식을 잘 안해

충돌 다 고쳤다 ㅅ

ㅗ 처리 어떻게 할까

블럭에 닿아있을때 벽에 충돌 안함 -> 왜? 맵 형식이라서 돼야하는데 -> 각각 충돌처리 해야하는데
아 처리는 각각하는데
불값이 하나라서 그렇구나
벽 불값이랑 블럭 불값 만들어야되나 생각해보자

아마도
충돌 도중에 블럭을 움직여서 충돌을 나가는 블럭이 생기면 뚫리는 듯 하다
충돌상태인지 불값을 받아오자
블럭중에 충돌 상태인 블럭이 있으면 다른 블럭은 함부로 false못하게
컨트롤러의 엔드 불값을 받아와서 컨트롤러가 윗충돌 켜져있으면 윗 충돌 못 끄게
이런식으로
아니지 잠만 무슨 소리야 테트로미노에 만들어야지 충돌한 개체가 있는지 확인해서 없으면 


exit 설정 해줘야됨

안 올라가
막힌게 false로 다시 안돼
뭔가 충돌하고 있는게 있는듯하다
아직 안 됨
종단점 찍은 곳으로 디버깅해봐

충돌은 잘 처리되게 했고
4개중에 3개가 충돌중이었어서 위로 안 올라가지고 다시 떨어지면 떨어졌다고 뜨는데 왜 안 올라가질까


테트로미노 조건 고쳐야됨

각 블럭마다 어디가 충돌했는지 저장해서
충돌한거에 따라 컨트롤러 조정
블럭마다 충돌한 개체가 여러개라서 하나로 조정하면 망가지는거지

나 스페이스바 언제 고쳤냐 -> 사실 m_stopTime=0.f; 때문에 망가지는거였을지도

드디어 ㅈ됐어
삭제를 나중에 몰아서 하겠다는 나의 안일함이 찾아왔다

delete gameobject; -> delete component; ->

삭제를 잘 했어야지...

소멸자에 종단점 박고 순서대로 들어가자

뭐가 가장 오래걸렸지 -> 뻐킹 콜라이더



자 초심으로 돌아가자 만드는거 금방이야

테트로미노가 각각 자기 바닥에 뭐가 어느 높이에 있는지를 파악해야해


다운로드 폴더에 내 현 작업물있음
벽 완성했으니까 인식시키자

바닥 체크 완료
벽 체크 해야됨

20240508
ㅜ의 오른쪽 ㅓ는 통하는데 왼쪽 ㅏ는 안 통함
ㅏㅜㅓ
^
이거만 안됨 고쳐
블럭높이가 1로 들어감 1이 아닌데

-2 2

절대값 고침

삭제는 내가 높이를 저장해서 확인하니까

이제 벽 체크 시작

왼쪽벽 기준 
앞쪽벽 기준

같이 체크해야돼

사용한 블럭중에 현재 블럭 높이의 한칸 밑 높이의 블럭이 있으면 바닥에 닿은 신호 메커니즘에서
이 블럭 왜 안 들어가는지 확인해
m_lastBlockHeight가 0이야

블럭 위에 블럭을 ㅓ 모양으로 쌓으니까 안 걸림

오후 6:17 2024-05-10
안 멈추니까 확인중이었음 지금 종단점에서 위치 봐봐

오후 7:45 2024-05-10
아니 자식 트랜스폼의 월드 포지션이 왜 이래 이상하잖아


오후 9:01 2024-05-10
_11의 3.57627869e-07가 _41에 그대로 들어가 고쳐

오전 5:39 2024-05-11
멈추고 1초안에 움직였는데 밑에 블럭 없으면 더 떨어지게

오전 6:46 2024-05-11
바닥에 블럭이 없을때도 false 시켜줘야되는데 바닥에 블럭이 없는거를 어떻게 비교해야할까

오후 3:50 2024-05-11
진짜 다 고쳤다 이제 삭제를 제대로 만들어

왜 삭제했을때 오브젝트가 55개 남아있을까


오후 12:09 2024-05-13
삭제 끝난거 같다
(메모리 누수 잡으면서 했어야했는데;;)

오전 11:14 2024-05-14
실수로 버텍스 인덱스 버퍼를 무한 생성하고 있었음
메모리 무한 복사 해결


오전 11:15 2024-05-14
delete한 객체를 다시 불러와서 그런지
릴리즈에서 오류가 뜬다

자 블럭이 안 내려가고 블럭이 색이 안 바뀌어

오후 2:17 2024-05-14
원래 블럭의 가족이었던 블럭이 삭제되면서 자기 블럭의 종속도 해제하는듯


오후 5:03 2024-05-14
다 고쳤는데 그늘에 숨으면 바닥으로 인식 안함 -> 최종 버그

오후 2:31 2024-05-16
같은 위치지만 내가 설치된 것보다 낮고,
하지만 그늘에 숨었을때 밑에 블럭이 있으면 인식하고 없으면 인식을 안하니까 조건 추가


오후 2:51 2024-05-16
텍스트 추가 중이었는데
뭘 고민하고 있었지
어떻게 렌더러에 넘겨줄까
스프라이트 뱃치 비긴 엔드가 있는데 그사이에 드로우 스트링을 여러개 벡터로 돌리면 되려나

오후 9:59 2024-05-16
텍스트 왜 안 나오지

오전 10:28 2024-05-17
어떻게 넘겨줄까

오후 7:23 2024-05-17
레벨 추가해줬고
홀딩 만들어야돼

그리고 메인메뉴, 레벨 정하기, 인게임씬, 게임오버 씬 만들기
게임오버는 씬을 따로 만들지 말고 인게임을 멈추게 하고 가운데에 게임오버 문자를 띄우자

오후 3:39 2024-05-20
ㅈ버그 아마 바닥 조건때문이거나 속도가 느려져서 그럴거임

오후 9:00 2024-05-20
모든 블럭을 검사해서
비활성화 안된 블럭이 있으면
유징블럭스가 올라서
유징블럭스가 0이 아니면
블럭 사용중인거고

오후 9:02 2024-05-20
사용중인 블럭을 검사해서
비활성화안된 블럭이 있으면 
유징 블럭스가 올라서
유징 블럭스가 사용중인 블럭 갯수가 안나오면 펄스

오후 9:35 2024-05-20
젠장 블럭이 공중에 뜨면 또 멈춰


오후 1:08 2024-05-21
-> 화살표로 위치 표시


오후 5:25 2024-05-21
게임오버랑 pit 남았네

오후 7:24 2024-05-23
아 비주얼스튜디오에서는 디버그 릴리즈 다 실행되는데 exe로 실행하면 다 안되네

